<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>一战到底</title>
</head>
<body>
<script type="text/template" id="tpl_question">
  <div class="content"><%= content %></div>
  <div class="option-list"></div>
  <input type='submit'>
</script>
<script type="text/template" id="tpl_option">
  <input type='radio' id='option-<%= id %>' name='question-option'>
  <label for='option-<%= id %>'><%= content %></label>
</script>
<script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="/bower_components/underscore/underscore-min.js"></script>
<script type="text/javascript" src="/bower_components/backbone/backbone-min.js"></script>
<script>
app = {}

app.Option = Backbone.Model.extend({});

app.Question = Backbone.Model.extend({});

app.QuestionCollection = Backbone.Collection.extend({
  model: app.Question
})

app.QuestionView = Backbone.View.extend({
  tagName: 'form',
  className: 'question',
  template: _.template($('#tpl_question').html()),
  render: function(){
    this.$el.html(this.template(this.model.toJSON()));
    this.renderAllOptions();
    return this;
  },
  renderOption: function(option){
    var view = new app.OptionView({model:option});
    this.$('option-list').append(view.render().el);
  },
  renderAllOptions: function(){
    var questionOptions = _.shuffle(questionView.model.get('options'));
    _.each(questionOptions, function(data){
      var model = new app.Option(data);
      var view = new app.OptionView({model:model});
      this.$('.option-list').append(view.render().el);
    }, this);
    return this;
  }
});

app.OptionView = Backbone.View.extend({
  tagName: 'div',
  className: 'question-option',
  template: _.template($('#tpl_option').html()),
  render: function(){
    this.$el.html(this.template(this.model.toJSON()));
    return this;
  }
})

question = new app.Question({
  id: 1,
  content: '根据集团公司《关于加强民主审议涉及员工切身利益规章制度和重大事项工作的意见》，企业要充分发扬民主，做好沟通协调工作。要严格履行职代会的民主程序，充分听取员工意见和建议。在此基础上，进行（ ），形成决议。',
  options: [
    {id: 1, content: '投票表决'},
    {id: 2, content: '分组讨论'},
    {id: 3, content: '领导审批'},
    {id: 4, content: '公司决定'}
  ]
})

var questionView = new app.QuestionView({model: question});

$("body").append(questionView.render().el);

</script>
</body>
</html>
