<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>一战到底</title>
</head>
<body>
<div id="app_container">
</div>
<script type="text/template" id="tpl_question">
  <div class="content"><%= content %></div>
  <div class="option-list"></div>
  <input type='submit'>
</script>
<script type="text/template" id="tpl_option_single">
  <input type='radio' id='option-<%= id %>' name='question-option'>
  <label for='option-<%= id %>'><%= content %></label>
</script>
<script type="text/template" id="tpl_option_multi">
  <input type='checkbox' id='option-<%= id %>' name='question-option'>
  <label for='option-<%= id %>'><%= content %></label>
</script>
<script type='text/template' id='tpl_welcome'>
  <%= welcome %>
</script>
<script type="text/template" id="tpl_too_early">
  <section class="reject">
    亲，本次活动未开始，<br />
    活动很精彩，敬请期待哦~~
  </section>
</script>
<script type="text/template" id="tpl_too_late">
  <section class="reject">
    亲，本次活动已结束，<br />
    下次要记得赶早哦~~~
  </section>
</script>
<script type="text/template" id="tpl_no_more_chance">
  <section class="reject">
    亲，您的答题次数已经用完，<br />
    下次活动再努力哦~~~
  </section>
</script>
<script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="/bower_components/underscore/underscore-min.js"></script>
<script type="text/javascript" src="/bower_components/backbone/backbone-min.js"></script>
<script type="text/javascript" src="/script/main.js"></script>
<script>
var game_code = window.location.hash.slice(1);
var data_url_root = '/data/' + game_code + '/';
$.getJSON(data_url_root + 'config.json').then(function(data){
  var application = new app.ApplicationView({game_code: game_code, config: data});
  var errorView = null;
  var used_chances = parseInt(localStorage.getItem(game_code + '_count'));
  if (used_chances > parseInt(data.max_chances)){
    errorView = new app.RejectionNoMoreChanceView();
  } else {
    var now = new Date();
    var start_at = new Date(data.start_at);
    var end_at = new Date(data.end_at);
    if(now < start_at){
      errorView = new app.RejectionTooEarlyView();
    } else if (now > end_at){
      errorView = new app.RejectionTooLateView();
    }
  };
  if(errorView){
    application.loadView(errorView);
  } else {
    $('#app_container').html('start!');
  }
});



// var application = new app.ApplicationView({game_code: game_code});

</script>
</body>
</html>
